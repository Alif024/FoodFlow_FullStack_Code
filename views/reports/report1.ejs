<%- include("../partials/head", { title, stylesheet }) %>
<main class="main-container report-page-container">
  <section class="content-card customer-table-card report-page-card">
    <div class="panel-header customer-header">
      <div>
        <span class="panel-badge">Report 1</span>
        <h1 class="panel-title">Sales by Time</h1>
        <p class="panel-description">Total orders and total sales grouped by day/month.</p>
      </div>
    </div>

    <form method="get" action="/reports/report1" class="customer-form-grid report-form">
      <label class="customer-form-field">
        <span>Group By</span>
        <select name="group_by">
          <option value="day" <%= filters.groupBy === "day" ? "selected" : "" %>>Day</option>
          <option value="month" <%= filters.groupBy === "month" ? "selected" : "" %>>Month</option>
        </select>
      </label>
      <label class="customer-form-field">
        <span>Start Date</span>
        <input type="date" name="start_date" value="<%= filters.startDate %>" />
      </label>
      <label class="customer-form-field">
        <span>End Date</span>
        <input type="date" name="end_date" value="<%= filters.endDate %>" />
      </label>
      <label class="customer-form-field">
        <span>Order Status</span>
        <select name="order_status">
          <option value="" <%= !filters.orderStatus ? "selected" : "" %>>All (except cancelled)</option>
          <option value="pending" <%= filters.orderStatus === "pending" ? "selected" : "" %>>pending</option>
          <option value="confirmed" <%= filters.orderStatus === "confirmed" ? "selected" : "" %>>confirmed</option>
          <option value="paid" <%= filters.orderStatus === "paid" ? "selected" : "" %>>paid</option>
          <option value="cancelled" <%= filters.orderStatus === "cancelled" ? "selected" : "" %>>cancelled</option>
        </select>
      </label>
      <div class="customer-form-actions">
        <button type="submit" class="customer-btn customer-btn--primary">Generate</button>
      </div>
    </form>

    <section class="report-summary" aria-label="Sales by time summary">
      <div class="report-summary-grid">
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalOrdersText %></div>
          <div class="stat-label">Total Orders</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalSalesText %></div>
          <div class="stat-label">Total Sales</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageOrderValueText %></div>
          <div class="stat-label">Average Order Value</div>
        </article>
      </div>
      <p class="report-summary-note">
        <% if (summary.hasData) { %>
          Best <%= summary.periodUnitLabel %>: <strong><%= summary.bestPeriod %></strong> (<%= summary.bestPeriodSalesText %>) |
          Lowest <%= summary.periodUnitLabel %>: <strong><%= summary.worstPeriod %></strong> (<%= summary.worstPeriodSalesText %>)
        <% } else { %>
          No data for the selected filters.
        <% } %>
      </p>
    </section>

    <section class="report-detail" aria-label="Sales by time detailed analysis">
      <h2 class="report-detail-title">Detailed Analysis</h2>
      <div class="report-summary-grid report-summary-grid--four">
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalPeriodsText %></div>
          <div class="stat-label"><%= summary.periodUnitLabel %>s Covered</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageSalesPerPeriodText %></div>
          <div class="stat-label">Avg Sales / <%= summary.periodUnitLabel %></div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageOrdersPerPeriodText %></div>
          <div class="stat-label">Avg Orders / <%= summary.periodUnitLabel %></div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.topPeriodSalesShareText %></div>
          <div class="stat-label">Top <%= summary.periodUnitLabel %> Share</div>
        </article>
      </div>
      <div class="report-detail-notes">
        <% if (summary.hasData) { %>
          <p class="report-detail-note">
            Highest orders: <strong><%= summary.highestOrdersPeriod %></strong> (<%= summary.highestOrdersText %> orders) |
            Lowest orders: <strong><%= summary.lowestOrdersPeriod %></strong> (<%= summary.lowestOrdersText %> orders)
          </p>
          <p class="report-detail-note">
            Recent trend (<%= summary.recentComparisonLabel %>): Sales <strong><%= summary.recentSalesTrendText %></strong>,
            Orders <strong><%= summary.recentOrdersTrendText %></strong>
          </p>
        <% } else { %>
          <p class="report-detail-note">No detailed analysis available because there is no data for these filters.</p>
        <% } %>
      </div>
    </section>

    <div class="customer-table-wrap">
      <table class="customer-table">
        <thead>
          <tr>
            <th>period</th>
            <th>total_orders</th>
            <th>total_sales</th>
          </tr>
        </thead>
        <tbody>
          <% if (!rows || !rows.length) { %>
            <tr><td colspan="3">No data</td></tr>
          <% } else { %>
            <% rows.forEach((row) => { %>
              <tr>
                <td><%= row.period %></td>
                <td><%= row.total_orders %></td>
                <td><%= row.total_sales %></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </section>
</main>
<%- include("../partials/foot", { script }) %>
