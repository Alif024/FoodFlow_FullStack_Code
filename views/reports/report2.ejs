<%- include("../partials/head", { title, stylesheet }) %>
<main class="main-container report-page-container">
  <section class="content-card customer-table-card report-page-card">
    <div class="panel-header customer-header">
      <div>
        <span class="panel-badge">Report 2</span>
        <h1 class="panel-title">Best Selling Menus</h1>
        <p class="panel-description">Top menus by quantity sold and sales amount.</p>
      </div>
    </div>

    <form method="get" action="/reports/report2" class="customer-form-grid report-form">
      <label class="customer-form-field">
        <span>Start Date</span>
        <input type="date" name="start_date" value="<%= filters.startDate %>" />
      </label>
      <label class="customer-form-field">
        <span>End Date</span>
        <input type="date" name="end_date" value="<%= filters.endDate %>" />
      </label>
      <label class="customer-form-field">
        <span>Order Status</span>
        <select name="order_status">
          <option value="" <%= !filters.orderStatus ? "selected" : "" %>>All (except cancelled)</option>
          <option value="pending" <%= filters.orderStatus === "pending" ? "selected" : "" %>>pending</option>
          <option value="confirmed" <%= filters.orderStatus === "confirmed" ? "selected" : "" %>>confirmed</option>
          <option value="paid" <%= filters.orderStatus === "paid" ? "selected" : "" %>>paid</option>
          <option value="cancelled" <%= filters.orderStatus === "cancelled" ? "selected" : "" %>>cancelled</option>
        </select>
      </label>
      <label class="customer-form-field">
        <span>Limit</span>
        <input type="number" name="limit" min="1" step="1" value="<%= filters.limit %>" />
      </label>
      <div class="customer-form-actions">
        <button type="submit" class="customer-btn customer-btn--primary">Generate</button>
      </div>
    </form>

    <section class="report-summary" aria-label="Best selling menus summary">
      <div class="report-summary-grid report-summary-grid--four">
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalMenusText %></div>
          <div class="stat-label">Menus Listed</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalQuantityText %></div>
          <div class="stat-label">Total Quantity</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.totalSalesText %></div>
          <div class="stat-label">Total Sales</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageSalesPerMenuText %></div>
          <div class="stat-label">Average Sales / Menu</div>
        </article>
      </div>
      <p class="report-summary-note">
        <% if (summary.hasData) { %>
          Best seller (qty): <strong><%= summary.bestByQuantityName %></strong> (<%= summary.bestByQuantityQtyText %> items, <%= summary.bestByQuantitySalesText %>) |
          Highest revenue: <strong><%= summary.bestBySalesName %></strong> (<%= summary.bestBySalesText %>) |
          Top 2 menu share: <strong><%= summary.topTwoSalesShareText %></strong>
        <% } else { %>
          No data for the selected filters.
        <% } %>
      </p>
    </section>

    <section class="report-detail" aria-label="Best selling menus detailed analysis">
      <h2 class="report-detail-title">Detailed Analysis</h2>
      <div class="report-summary-grid report-summary-grid--four">
        <article class="stat-item">
          <div class="stat-value"><%= summary.topOneSalesShareText %></div>
          <div class="stat-label">Top 1 Menu Share</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.topThreeSalesShareText %></div>
          <div class="stat-label">Top 3 Menus Share</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageQuantityPerMenuText %></div>
          <div class="stat-label">Avg Qty / Menu</div>
        </article>
        <article class="stat-item">
          <div class="stat-value"><%= summary.averageRevenuePerItemText %></div>
          <div class="stat-label">Avg Revenue / Item</div>
        </article>
      </div>
      <div class="report-detail-notes">
        <% if (summary.hasData) { %>
          <p class="report-detail-note">
            Category leader: <strong><%= summary.topCategoryName %></strong> (<%= summary.topCategorySalesText %>,
            share <strong><%= summary.topCategorySalesShareText %></strong>)
          </p>
          <p class="report-detail-note">
            Best unit revenue: <strong><%= summary.bestUnitRevenueName %></strong> (<%= summary.bestUnitRevenueText %> / item) |
            Lowest performer: <strong><%= summary.leastSellingName %></strong> (<%= summary.leastSellingQtyText %> items,
            <%= summary.leastSellingSalesText %>)
          </p>
        <% } else { %>
          <p class="report-detail-note">No detailed analysis available because there is no data for these filters.</p>
        <% } %>
        <p class="report-detail-note report-detail-note--subtle">
          Note: share metrics are calculated from the currently listed rows and are affected by the Limit filter.
        </p>
      </div>
    </section>

    <div class="customer-table-wrap">
      <table class="customer-table">
        <thead>
          <tr>
            <th>menu_id</th>
            <th>menu_name</th>
            <th>category</th>
            <th>total_quantity</th>
            <th>total_orders</th>
            <th>total_sales</th>
          </tr>
        </thead>
        <tbody>
          <% if (!rows || !rows.length) { %>
            <tr><td colspan="6">No data</td></tr>
          <% } else { %>
            <% rows.forEach((row) => { %>
              <tr>
                <td><%= row.menu_id %></td>
                <td><%= row.menu_name %></td>
                <td><%= row.category_name || "-" %></td>
                <td><%= row.total_quantity %></td>
                <td><%= row.total_orders %></td>
                <td><%= row.total_sales %></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </section>
</main>
<%- include("../partials/foot", { script }) %>
